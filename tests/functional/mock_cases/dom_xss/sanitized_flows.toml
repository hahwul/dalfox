# DOM XSS test cases with sanitization (should NOT be detected as vulnerable)
# These test cases represent safe patterns that use proper sanitization

[[case]]
id = 1401
name = "textcontent_safe"
description = "Using textContent instead of innerHTML (safe)"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var param = location.search.substring(1);
document.getElementById('safe').textContent = param;
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1402
name = "dompurify_sanitized"
description = "Using DOMPurify sanitization before innerHTML"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="sanitized"></div>
<script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
<script>
var dirty = location.search.substring(1);
var clean = DOMPurify.sanitize(dirty);
document.getElementById('sanitized').innerHTML = clean;
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1403
name = "createtextnode_safe"
description = "Using createTextNode (safe)"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="container"></div>
<script>
var param = location.hash.substring(1);
var textNode = document.createTextNode(param);
document.getElementById('container').appendChild(textNode);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1404
name = "encodehtml_sanitized"
description = "Custom HTML encoding before insertion"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="encoded"></div>
<script>
function encodeHTML(str) {
  return str.replace(/[&<>"']/g, function(match) {
    return {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    }[match];
  });
}

var param = location.search.substring(1);
var safe = encodeHTML(param);
document.getElementById('encoded').innerHTML = safe;
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1405
name = "innertext_safe"
description = "Using innerText instead of innerHTML"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var input = location.hash.substring(1);
document.getElementById('safe').innerText = input;
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1406
name = "setattribute_class_safe"
description = "setAttribute on non-dangerous class attribute"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="item"></div>
<script>
var input = location.search.substring(1);
document.getElementById('item').setAttribute('class', input);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1407
name = "setattribute_data_attribute_safe"
description = "setAttribute on data-* attribute is safe for script execution"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="item"></div>
<script>
var input = location.search.substring(1);
document.getElementById('item').setAttribute('data-value', input);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1408
name = "append_textnode_safe"
description = "createTextNode + appendChild safe flow"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var input = location.search.substring(1);
var node = document.createTextNode(input);
document.getElementById('safe').appendChild(node);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1409
name = "encodeuricomponent_before_location_assign"
description = "encodeURIComponent before location.assign should be treated as sanitized"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script>
var input = location.hash.substring(1);
var safe = encodeURIComponent(input);
location.assign(safe);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1410
name = "document_createtextnode_inline_safe"
description = "Inline createTextNode call without intermediate variable"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var input = location.search.substring(1);
document.getElementById('safe').appendChild(document.createTextNode(input));
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1411
name = "function_wrapper_textcontent_safe"
description = "Tainted argument passed to function that uses textContent safely"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="out"></div>
<script>
function safeRender(value) {
  document.getElementById('out').textContent = value;
}
var input = location.search.substring(1);
safeRender(input);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1412
name = "function_expression_textcontent_safe"
description = "Function expression uses textContent safely"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var safeRender = function(value) {
  document.getElementById('safe').textContent = value;
};
var input = location.hash;
safeRender(input);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1413
name = "arrow_function_textcontent_safe"
description = "Arrow function uses textContent safely"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var safeRender = (value) => {
  document.getElementById('safe').textContent = value;
};
var input = location.search;
safeRender(input);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1414
name = "named_message_handler_textcontent_safe"
description = "Named message callback with textContent should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
function onMessage(event) {
  document.getElementById('safe').textContent = event.data;
}
window.addEventListener('message', onMessage);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1415
name = "object_html_property_assignment_only_safe"
description = "Assigning to plain object html property without sink should not trigger"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script>
var model = {};
model.html = location.hash;
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1416
name = "computed_textcontent_assignment_safe"
description = "Computed textContent assignment is safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var input = location.search;
var el = document.getElementById('safe');
el['textContent'] = input;
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1417
name = "computed_setattribute_class_safe"
description = "Computed setAttribute with class should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var input = location.hash;
var el = document.getElementById('safe');
el['setAttribute']('class', input);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1418
name = "summary_call_wrapper_textcontent_safe"
description = "Function.call wrapper to safe textContent sink should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="out"></div>
<script>
function safeRender(value) {
  document.getElementById('out').textContent = value;
}
safeRender.call(null, location.hash);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1419
name = "summary_apply_wrapper_textcontent_safe"
description = "Function.apply wrapper to safe textContent sink should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="out"></div>
<script>
function safeRender(value) {
  document.getElementById('out').textContent = value;
}
safeRender.apply(null, [location.search]);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1420
name = "object_method_textcontent_safe"
description = "Object literal method using textContent should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var helper = {
  render(value) {
    document.getElementById('safe').textContent = value;
  }
};
helper.render(location.hash);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1421
name = "class_method_textcontent_safe"
description = "Class method using textContent should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
class Renderer {
  render(value) {
    document.getElementById('safe').textContent = value;
  }
}
var r = new Renderer();
r.render(location.search);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1422
name = "dynamic_setattribute_safe_concat"
description = "Dynamic setAttribute safe data-* name should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var value = location.hash;
document.getElementById('safe').setAttribute('data-' + 'id', value);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1423
name = "dynamic_execcommand_non_html_safe"
description = "execCommand non-HTML command should remain safe in this model"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script>
var value = location.search;
document.execCommand('copy' + '', false, value);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1424
name = "bound_object_method_textcontent_safe"
description = "Bound object method that uses textContent should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="safe"></div>
<script>
var helper = {
  render(value) {
    document.getElementById('safe').textContent = value;
  }
};
var bound = helper.render.bind(helper);
bound(location.search);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1425
name = "bound_sink_alias_with_sanitized_input"
description = "Bound sink alias invoked with sanitized input should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
<script>
var writer = document.write.bind(document);
var clean = DOMPurify.sanitize(location.hash);
writer(clean);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1426
name = "bound_summary_prebound_safe_literal"
description = "Function summary with safe literal pre-bound argument should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<div id="out"></div>
<script>
function render(value) {
  document.getElementById('out').innerHTML = value;
}
var bound = render.bind(null, 'safe');
bound();
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1427
name = "bound_sink_prebound_sanitized_input"
description = "Sink alias with sanitized pre-bound argument should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
<script>
var writer = document.write.bind(document, DOMPurify.sanitize(location.hash));
writer();
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1428
name = "computed_non_sink_property_concat_safe"
description = "Computed non-sink property name should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script>
var payload = location.hash;
document['wri' + 'ten'](payload);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1429
name = "summary_apply_non_sink_param_tainted_safe"
description = "Function.apply taint in non-sink parameter should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script>
function render(a, b) {
  document.write(a);
}
render.apply(null, ['safe', location.search]);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1430
name = "bound_sink_alias_call_wrapper_sanitized"
description = "Bound sink alias through call wrapper with sanitized argument should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
<script>
var writer = document.write.bind(document);
writer.call(null, DOMPurify.sanitize(location.hash));
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1431
name = "bound_sink_alias_apply_wrapper_sanitized"
description = "Bound sink alias through apply wrapper with sanitized argument should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
<script>
var writer = document.write.bind(document);
writer.apply(null, [DOMPurify.sanitize(location.search)]);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1432
name = "bound_summary_apply_non_sink_param_tainted_safe"
description = "Bound summary apply with taint only in non-sink parameter should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script>
function render(a, b) {
  document.write(a);
}
var bound = render.bind(null);
bound.apply(null, ['safe', location.hash]);
</script>
</body>
</html>
"""
expected_detection = false

[[case]]
id = 1433
name = "bind_chain_prebound_sanitized_safe"
description = "Chained bind with sanitized pre-bound argument should remain safe"
handler_type = "dom_xss"
reflection = """
<html>
<body>
<script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
<script>
var base = document.write.bind(document, DOMPurify.sanitize(location.hash));
var chained = base.bind(null);
chained();
</script>
</body>
</html>
"""
expected_detection = false
